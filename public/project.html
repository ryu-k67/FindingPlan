<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!--  -->
    <script src="/__/firebase/6.2.0/firebase-app.js"></script>
    <script src="/__/firebase/6.2.0/firebase-firestore.js"></script>
    <script src="/__/firebase/6.2.0/firebase-auth.js"></script>
    <script src="/__/firebase/init.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>プロジェクト-Finding Plan</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="base.css" />
    <style>
        .headingRow {
            top: 0;
        }

        .headingCol span {
            position: sticky;
            top: 0;
            left: 0;
            /**/
            background-color: #fff;
        }

        .openbtn {
            position: relative;
            width: 50px;
            height: 50px;
        }

        .openbtn span {
            display: inline-block;
            transition: all.4s;
            position: absolute;
            left: 13px;
            height: 2px;
            background-color: #666;
        }

        .openbtn span:nth-of-type(1) {
            top: 25px;
            width: 50%;
            transform: rotate(90deg);
        }

        .openbtn span:nth-of-type(2) {
            top: 25px;
            width: 50%;
        }

        .openbtn.active span:nth-of-type(1) {
            transform: rotate(-45deg);
            width: 50%;
        }

        .openbtn.active span:nth-of-type(2) {
            transform: rotate(45deg);
            width: 50%;
        }

        table {
            width: 92%;
        }

        table td.drag {
            min-width: 20px;
            height: 10px;
        }

        td {
            min-width: 20px;
            height: 10px;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #fff;
        }

        th {
            padding: 0 1em;
        }

        /*保存ボタンの非表示*/
        .saveHideArea {
            display: none;
        }

        /* 616px以上 */
        @media only screen and (min-width: 616px),
        print {
            .selectStatusClass {
                display: flex;
            }

            .content {
                padding: 0 2rem;
                width: 68%;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <h1>
            <a href="/" class="header-title">Finding&nbsp;Plan</a>
        </h1>
        <nav class="navigation">
            <ul class="navigationList">
                <li><button id="mypage" class="mypageBtn" onclick="mypageClick()">Myページ へ</button></li>
                <li><button class="btnripple" onclick="logout()">ログアウト</button></li>
            </ul>
        </nav>
    </header>
    <div class="content">
        <p id="innerName" class="contentTitle del paddingLeft30"></p>
        <!-- コピー対象要素とコピーボタン -->
        <button class="btnripple left30" onclick="copyToClipboard()" style="margin-bottom: 0.7em;">URLをコピー</button>
        <button class="btnPickUp" onclick="clickPickUp()" style="margin-bottom: 0.7em;">ピックアップ</button>

        <form id="selectStatusForm" class="paddingLeft30 selectStatusClass">
            <div class="highlight">
                <label for="high"><input type="radio" id="high" name="selectStatus" value="HIGHLIGHTED" class="radioH"
                        checked><span class="radioH">参加可能</span></label>
            </div>
            <div class="middlelight">
                <label for="middle"><input type="radio" id="middle" name="selectStatus" class="radioM"
                        value="MIDDLELIGHTED"><span class="radioM">未確定,要調整</span></label>
            </div>
            <div class="notHighlight">
                <label for="not"><input type="radio" id="not" name="selectStatus" class="radioN"
                        value="NOTLIGHTED"><span class="radioN">参加不可</span></label>
            </div>
        </form>
        <div id="dragTableArea"></div>
        <div class="guideArea firstGuide">
            <p>[1]表の+を押す. </p>
        </div>
        <ul class="underTable">
            <ui>
                <div class="hideArea">
                    <div class="guideArea del">
                        <p class="del">[2-1]ログインする方は下のボタンを押してください.</p>
                    </div>
                    <button id="login" class="btnripple left30" onclick="onClickLogin()">ログイン</button>
                </div>
            </ui>
            <ui style="padding: 0 1em;">
                <div class="hideArea">
                    <div class="guideArea del">
                        <p class="del">[2-2]ログインしない方は下の入力欄に入力してください.</p>
                    </div>
                    <label class="effect">
                        <input id="unLoginUserName" type="text" placeholder="名前を入力し, Enterを押してください."
                            style="width: 17.3em;">
                    </label>
                </div>
            </ui>
        </ul>

        <div class="saveHideArea">
            <ul class="del underTable">
                <ui class="del">
                    <button id="scheduleSaveButton" class="btnripple"
                        onclick="scheduleSave()"><span>スケジュールを保存</span></button>
                </ui>
                <ui class="del">
                    <div class="guideArea paddingLeft30">
                        <p class="paddingLeft30 del">[3]ドラック&ドロップで可能な時間をオレンジ, 不可能な時間を灰色にしてください.</p>
                        <p class="paddingLeft30 del ">[4]スケジュールを保存ボタンを押してください.</p>
                        <p class="paddingLeft30 del ">[5]URLをコピーを押して,プロジェクトメンバーに共有してください.</p>
                    </div>
                </ui>
            </ul>
        </div>

        <div id="pickUpTableArea">
            <table id="pickUpTable" cellpadding="0" cellspacing="0"></table>
        </div>

    </div>

</body>

<script src="firebaseCode.js"></script>
<script src="firebaseCode_ryosuke.js"></script>
<script src="firebaseFunctions.js"></script>
<script src="change.js"></script>

<script>
    //----------------------------------------------------------------
    let db = firebase.firestore();
    //ログインしてない人の名前------------
    var unLoginUserName;
    var userId = null;
    var start;
    var finish;
    var memberName;
    var userSchedule;
    var schedule;//ピックアップ用
    //ログインした人のmemberIndex-------
    var loginMemberIndex = null;
    //--------------------------------
    //テーブル作成------------------------------------------------------
    //状況の取得------------------------
    function confirm(){
        //認証状態の確認
        firebase.auth().onAuthStateChanged(async function (user) {
            if (user) {
                userId = firebase.auth().currentUser.uid;
                console.log(userId);
                loginMemberIndex = await getLoginMemberIndex(userId);
            }
            console.log(loginMemberIndex);
        });
        return loginMemberIndex;
    }
    document.addEventListener('DOMContentLoaded', async (event) => {
        let projectName = await getProjectName();
        console.log(projectName);
        innerName.innerHTML = projectName;
        var week = ["日", "月", "火", "水", "木", "金", "土"];
        //開始日と終了日の取得----------------
        finish = await getProjectPeriodFinish();
        start = await getProjectPeriodStart();
        var tableTag = $("<table id=\"dragTable\" class=\"dragArea\" cellpadding=\"0\" cellspacing=\"0\">");

        //1行目の作成-----------------------
        var tableFirstRow = $("<tr></tr>").appendTo(tableTag);
        var doubleHeadingCell = $("<th class=\"doubleHeading\" rowspan=\"2\"></th>").appendTo(tableFirstRow);
        for (let i = new Date(start); i <= finish; i.setDate(i.getDate() + 1)) {
            $("<th class=\"headingCol\" colspan=\"144\"><p><span>" + (i.getMonth() + 1) + "/" + i.getDate() + "(" + week[i.getDay()] + ")" + "</span></p></th>").appendTo(tableFirstRow);
        }

        //2行目の作成-----------------------
        var tableSecondRow = $("<tr></tr>").appendTo(tableTag);
        for (let i = new Date(start); i <= finish; i.setDate(i.getDate() + 1)) {
            for (let j = 0; j < 24; j++) {
                $("<th colspan=\"6\" class=\"time headingCol\"><p><span>" + j + ":" + "</span></p></th>").appendTo(tableSecondRow);
            }
        }
        //認証状態の確認
        loginMemberIndex=confirm();
        //それぞれのメンバーの行--------------
        memberName = await getProjectMembers();
        console.log(memberName);
        console.log("memberName.length : " + memberName.length);
        console.log("memberIndex:" + loginMemberIndex);
        
        for (let i = 0; i < memberName.length; i++) {
            console.log(loginMemberIndex);
            var memberSch = await getProjectMemberSchedule(i);
            console.log(memberSch);
            if (memberSch == undefined || memberSch == null) {
                console.log(loginMemberIndex);
                break;
            }
            var memberRow = await adjustSchedule(memberSch, i);
            var tableRow = $("<tr></tr>").appendTo(tableTag);
            var count = 0;
            console.log(loginMemberIndex);
            if (i == loginMemberIndex) {
                //ログインした人のための処理----------
                console.log("ログインした人のための処理");
                $("<th class=\"headingRow\" ><p><input type=\"checkbox\" id="+"checkBox_"+i+" checked>" + memberName[i] + "</p></th>").appendTo(tableRow);
                console.log("error前のuserId" + userId);
                console.log("error前のloginMemberIndex" + loginMemberIndex);
                userSchedule = await getUserSchedule(userId);
                for (let j = new Date(start); j <= finish; j.setDate(j.getDate() + 1)) {
                    for (let k = 0; k < 144; k++) {
                        if ((memberRow[count] % 3) == 0) {
                            $("<td id=\"cell" + count + "\" class=\"drag\"></td>").appendTo(tableRow);
                        } else if ((memberRow[count] % 3) == 2) {
                            $("<td id=\"cell" + count + "\" class=\"highlighted drag\"></td>").appendTo(tableRow);
                        } else if ((memberRow[count] % 3) == 1) {
                            $("<td id=\"cell" + count + "\" class=\"middlelighted drag\"></td>").appendTo(tableRow);
                        }
                        count++;
                    }
                }
                //saveButtonを表示-----------------
                $(".saveHideArea").show();
                //firstGuideを非表示---------------
                $(".firstGuide").hide();
            } else {
                console.log("ログインしてない人のための処理");
                $("<th class=\"headingRow\" ><input type=\"checkbox\" id="+"checkBox_"+i+" checked>" + memberName[i] + "</th>").appendTo(tableRow);
                for (let j = new Date(start); j <= finish; j.setDate(j.getDate() + 1)) {
                    for (let k = 0; k < 144; k++) {
                        if ((memberRow[count] % 3) == 0) {
                            $("<td class=\"notHighlighted\"></td>").appendTo(tableRow);
                        } else if ((memberRow[count] % 3) == 2) {
                            $("<td class=\"highlighted\"></td>").appendTo(tableRow);
                        } else if ((memberRow[count] % 3) == 1) {
                            $("<td class=\"middlelighted\"></td>").appendTo(tableRow);
                        }
                        count++;
                    }
                }
            }
            console.log(start, finish);
            console.log(memberRow);

        }
        console.log(loginMemberIndex);
        if (loginMemberIndex == null) {
            //新規欄-----------------------------------------------------------
            var tableRow = $("<tr></tr>").appendTo(tableTag);
            var plusCellbox = $("<th id=\"plusCellbox\" class=\"headingRow\"></th>").appendTo(tableRow);
            console.log("unregister");
            unregistered();
        } else {
            console.log("register");
            registered();
        }
        async function registered() {
            $("#dragTableArea").append(tableTag);
            //テーブルのサイズ調整----------------
            $(".headingCol span").css("left", doubleHeadingCell.outerWidth() + 10 + "px");
            //テーブルのドラックした時の処理---------------------------------------
            var isMouseDown = false;
            //formの情報取得のための変数
            var forms = $(".selectStatusForm");
            var radioList = forms.selectStatus;
            $(".drag")
                .mousedown(function () {
                    isMouseDown = true;
                    //formの情報取得
                    var status = $('input:radio[name="selectStatus"]:checked').val();
                    console.log("value=" + status);
                    switch (status) {
                        case "HIGHLIGHTED":
                            $(this).removeClass("middlelighted");
                            $(this).removeClass("notlighted");
                            $(this).addClass("highlighted");
                            break;
                        case "MIDDLELIGHTED":
                            $(this).removeClass("highlighted");
                            $(this).removeClass("notlighted");
                            $(this).addClass("middlelighted");
                            break;
                        case "NOTLIGHTED":
                            $(this).removeClass("highlighted");
                            $(this).removeClass("middlelighted");
                            $(this).addClass("notlighted");
                            break;

                    }
                    return false; // prevent text selection
                })
                .mouseover(function () {
                    if (isMouseDown) {
                        var status = $('input:radio[name="selectStatus"]:checked').val();
                        console.log("value=" + status);
                        switch (status) {
                            case "HIGHLIGHTED":
                                $(this).removeClass("middlelighted");
                                $(this).removeClass("notlighted");
                                $(this).addClass("highlighted");
                                break;
                            case "MIDDLELIGHTED":
                                $(this).removeClass("highlighted");
                                $(this).removeClass("notlighted");
                                $(this).addClass("middlelighted");
                                break;
                            case "NOTLIGHTED":
                                $(this).removeClass("highlighted");
                                $(this).removeClass("middlelighted");
                                $(this).addClass("notlighted");
                                break;

                        }
                    }
                });
            $(document)
                .mouseup(function () {
                    isMouseDown = false;
                });
        }


        //認証状態の確認
        //==================================================================================
        /*firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                userId = firebase.auth().currentUser.uid;
                console.log(userId);

            }
            unregistered();
        });*/
        function sleep(waitMsec) {
            var startMsec = new Date();

            // 指定ミリ秒間だけループさせる（CPUは常にビジー状態）
            while (new Date() - startMsec < waitMsec);
        }

        //sleep(10000);
        console.log("ここ");
        async function unregistered() {
            if (userId != null) {
                console.log("ろぐいんした");
                //ログインした人のための処理----------
                $("<p>" + (await getUserName(userId)) + "<p>").appendTo(plusCellbox);
                console.log(userId);
                userSchedule = await getUserSchedule(userId);
                console.log(userSchedule);
                var i = 0;
                for (let j = new Date(start); j <= finish; j.setDate(j.getDate() + 1)) {
                    for (let k = 0; k < 144; k++) {
                        if ((userSchedule[i] % 3) == 0) {
                            $("<td id=\"cell" + i + "\" class=\"drag\"></td>").appendTo(tableRow);
                        } else if ((userSchedule[i] % 3) == 2) {
                            $("<td id=\"cell" + i + "\" class=\"highlighted drag\"></td>").appendTo(tableRow);
                        } else if ((userSchedule[i] % 3) == 1) {
                            $("<td id=\"cell" + i + "\" class=\"middlelighted drag\"></td>").appendTo(tableRow);
                        }
                        i++;
                    }
                }
                //saveButtonを表示-----------------
                $(".saveHideArea").show();
                //firstGuideを非表示---------------
                $(".firstGuide").hide();
            }
            else {
                console.log("ろぐいんしてない");
                //ログインしてない人のための処理-------
                var i = 0;
                $("<div id=\"modalOpen\" class=\"openbtn\"><span></span><span></span></div>").appendTo(plusCellbox);
                for (let j = new Date(start); j <= finish; j.setDate(j.getDate() + 1)) {
                    for (let k = 0; k < 144; k++) {
                        $("<td id=\"cell" + i + "\" class=\"drag\"></td>").appendTo(tableRow);
                        i++;
                    }
                }
            }

            console.log("無視");
            $("#dragTableArea").append(tableTag);
            //テーブルのサイズ調整----------------
            $(".headingCol span").css("left", plusCellbox.outerWidth() + 10 + "px");
            //テーブルのドラックした時の処理---------------------------------------
            var isMouseDown = false;
            //formの情報取得のための変数
            var forms = $(".selectStatusForm");
            var radioList = forms.selectStatus;
            $(".drag")
                .mousedown(function () {
                    isMouseDown = true;
                    //formの情報取得
                    var status = $('input:radio[name="selectStatus"]:checked').val();
                    console.log("value=" + status);
                    switch (status) {
                        case "HIGHLIGHTED":
                            $(this).removeClass("middlelighted");
                            $(this).removeClass("notlighted");
                            $(this).addClass("highlighted");
                            break;
                        case "MIDDLELIGHTED":
                            $(this).removeClass("highlighted");
                            $(this).removeClass("notlighted");
                            $(this).addClass("middlelighted");
                            break;
                        case "NOTLIGHTED":
                            $(this).removeClass("highlighted");
                            $(this).removeClass("middlelighted");
                            $(this).addClass("notlighted");
                            break;

                    }
                    return false; // prevent text selection
                })
                .mouseover(function () {
                    if (isMouseDown) {
                        var status = $('input:radio[name="selectStatus"]:checked').val();
                        console.log("value=" + status);
                        switch (status) {
                            case "HIGHLIGHTED":
                                $(this).removeClass("middlelighted");
                                $(this).removeClass("notlighted");
                                $(this).addClass("highlighted");
                                break;
                            case "MIDDLELIGHTED":
                                $(this).removeClass("highlighted");
                                $(this).removeClass("notlighted");
                                $(this).addClass("middlelighted");
                                break;
                            case "NOTLIGHTED":
                                $(this).removeClass("highlighted");
                                $(this).removeClass("middlelighted");
                                $(this).addClass("notlighted");
                                break;

                        }
                    }
                });
            $(document)
                .mouseup(function () {
                    isMouseDown = false;
                });

            //+ボタンを押された時のログイン関係処理---------------------------------
            $(".openbtn").click(function () {
                if (!$(this).hasClass("active")) {
                    $(".hideArea").show();
                }
                else {
                    $(".hideArea").hide();
                }
                $(this).toggleClass("active");
            })

            //ログインしていない人が名前を入力したとき-------------------------------
            $("#unLoginUserName")[0].addEventListener("keypress", getUnLoginUserName);
            function getUnLoginUserName(e) {
                if (e.keyCode === 13) {
                    unLoginUserName = $("#unLoginUserName").val();
                    $(".hideArea").hide();
                    $("#modalOpen").hide();
                    $("<p>" + unLoginUserName + "</p>").appendTo($("#plusCellbox"));
                    //$("#plusCellbox").outerWidth();

                    //テーブルのサイズ調整----------------
                    $(".headingCol span").css("left", plusCellbox.outerWidth() + 10 + "px");
                    //$(".headiing");
                    //saveButtonを表示-----------------
                    $(".saveHideArea").show();
                    //firstGuideを非表示---------------
                    $(".firstGuide").hide();
                }
            }
        }

        
        schedule=await pickUp();
        console.log(schedule);
        if(schedule[0]!=null){
            clickPickUp();
        }
        console.log("作成完了");

    });
    //-----------------------------------------------------
    async function clickPickUp(){
        let pickUpSchedule=await pick(schedule);
        let table = document.getElementById("pickUpTable");
        console.log(table.rows.length);
        if(table.rows.length>=1){
            console.log("1");
            table.deleteRow(0);
            console.log(table.rows.length);
            table.deleteRow(0);
            console.log(table.rows.length);
        }
        //テーブルの作成
        let tableRowOne=$("<tr></tr>").appendTo(table);
        $("<th><p><span>" + "参加可能日のみ" + "</span></p></th>").appendTo(tableRowOne);
        $("<th><p><span>" + "未確定を含む" + "</span></p></th>").appendTo(tableRowOne);

        let tableRowTwo=$("<tr></tr>").appendTo(table);
        $("<td><p><span style=\"white-space: pre-line\">" + pickUpSchedule[0] + "</span></p></td>").appendTo(tableRowTwo);
        $("<td><p><span style=\"white-space: pre-line\">" + pickUpSchedule[1] + "</span></p></td></table>").appendTo(tableRowTwo);
        
    }
    //----------------------------------------------------
    function scheduleSave() {
        console.log("scheduleSave()");
        var scheduleArray = [];
        var i = 0;
        for (var j = new Date(start); j <= finish; j.setDate(j.getDate() + 1)) {
            for (var k = 0; k < 144; k++) {
                if ($("#cell" + i).hasClass("highlighted")) {
                    scheduleArray.push(2);
                } else if ($("#cell" + i).hasClass("middlelighted")) {
                    scheduleArray.push(1);
                } else {
                    scheduleArray.push(0);
                }
                i++;
            }
        }
        let num = memberName.length;
        if (memberName[0] == "") {
            num--;
        }
        console.log("scheduleArray:" + scheduleArray);
        if (userId != null) {
            //ログインした人のための処理----------
            console.log(userSchedule);
            setLoginMember(userId, scheduleArray, userSchedule);
        } else {
            //ログインしてない人のための処理-------
            setJoinMember(unLoginUserName, scheduleArray);
        }
        //pickUp();
    }
    //--------------------------------------------------------
    async function getProjectPeriod() {
        var start = await getProjectPeriodStart();
        var finish = await getProjectPeriodFinish();
        for (var i = new Date(start); i <= finish; i.setDate(i.getDate() + 1)) {
        }
        return i;
    }
    //仮のfunction----------------------------------------------------
    function getParam(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
    /*あるプロジェクトの期間のあるユーザーのマイスケジュールを返す*/
    //async function getUserSchedule(userId){
    /*あるプロジェクトIDのプロジェクトの開始日、終了日を取得する*/
    /*    var projectId = getParam("project");
        var period = [];
        period = db.collection("project").doc(projectId).get()
        .then((querySnapshot)=>{
            return querySnapshot.data()[""]
        })
        /*あるユーザーIDをもつユーザーのプロジェクトの期間のマイスケジュールを取得する*/
    /*    var projectPeriodMySchedule = [];
        projectPeriodMySchedule = db.collection("account").doc(userId).collection("myScheduleId").where("date", ">=", period[0])
                                                                                            .where("date", "<=", period[1]).get();
        return projectPeriodMySchedule;
    }*/
    async function getUserName(userId) {
        if (!userId) {
            userId = firebase.auth().currentUser.uid;
        }
        else {
            console.log(userId);
            var userName = await db.collection("account").doc(userId).get()
                .then((querySnapshot) => {
                    //console.log(querySnapshot);
                    let temp = querySnapshot.data()["name"];
                    //console.log(temp);
                    console.log(temp);
                    return temp;
                })
        }
        console.log(userName);
        return userName;
    }
    /*
    function getProjectMembers(){
        let ID;
        let buff;
        ID = getParam("project");
        const docRef = db.ref("project/ID");
        let members;
        docRef.get().then((doc)=>{
            members = doc.data();
            console.log(members);
        }).catch((error)=>{
            console.log("データ取得失敗");
        })
        return members;
    }
    */
    /*
        async function getProjectMembers() {
            let ID;
            let buff;
    
            ID = getParam("project");
            buff = await db.collection("project").doc(ID).get()
                .then((querySnapshot) => {
                    //console.log(querySnapshot.data()["projectmenberName"]);
                    let temp = querySnapshot.data()["projectmenberName"];
                    console.log(temp);
                    //buff = querySnapshot.data()["projectmenberName"];
                    //console.log(buff);
                    //return buff; //MemberのMがfirebaseで小文字になってる
                    //console.log(start);
                    //const docSnapshot = querysnapshot.docs;
                    //console.log(docSnapshot);
                    return temp;
                })
                .catch((error) => {
                    console.log("データの取得失敗");
                })
            console.log(buff);
            return buff; //MemberのMがfirebaseで小文字になってる
        }
    
        async function getProjectPeriodStart() {
            let ID;
            ID = getParam("project");
            var buff;
            buff = db.collection("project").doc(ID);
            var start = buff.get().then((querySnapshot) => {
                //console.log(querySnapshot.data()["projectPeiriod"]); 
                let start = new Date(querySnapshot.data()["projectPeiriod"][0] / 10000, (querySnapshot.data()["projectPeiriod"][0] % 10000) / 100, (querySnapshot.data()["projectPeiriod"][0] % 100));
                //console.log(start);
                return start;
            })
                .catch((error) => {
                    console.log("データの取得失敗");
                })
            //console.log("取得S"+start);
            return start;
        }
    
        async function getProjectPeriodFinish() {
            let ID;
            ID = getParam("project");
            var buff;
            buff = db.collection("project").doc(ID);
            var finish = await buff.get().then((querySnapshot) => {
                //console.log(querySnapshot.data()["projectPeiriod"]); 
                let end = new Date(querySnapshot.data()["projectPeiriod"][1] / 10000, (querySnapshot.data()["projectPeiriod"][1] % 10000) / 100, (querySnapshot.data()["projectPeiriod"][1] % 100));
                //console.log(end);
                return end;
            })
                .catch((error) => {
                    console.log("データの取得失敗");
                })
            //console.log("取得F"+finish);
            return finish;
        }
    
        async function getProjectMemberSchedule(memberIndex) {
            /*
            var ID=getParam("project");
            var data = [];
            data=await db.collection("project").doc(ID).collection("projectMenberPeriod").where("memberIndex","==",memberIndex)
            .get().then((querySnapshot) =>{
                let snap= querySnapshot.forEach((doc) => {
                    let temp = doc.data()["projectSchedule"];
                    //projectSchedule.push(data.projectSchedule);
                    console.log(temp);
                    return temp;
                });
                console.log(snap);
                return snap;
            }).catch((error) => {
                console.log("データの取得に失敗しました(${error})");
            })
            console.log(data);
            return data;
            */
    /*        return [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1
            ];
        }
    */

    //ログイン画面へ遷移--------------------------------------------
    function onClickLogin() {
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                userId = firebase.auth().currentUser.uid;
                console.log(userId);
            }
            else {
                let projectId = getParam("project");
                window.location = "login.html?project=" + projectId;
            }
        });
    }
    //----------------------------------------------------------------

    //URLをコピーする---------------------------------------------------
    function copyToClipboard() {
        var url = location.href;
        navigator.clipboard.writeText(url);
    }


    //登録ボタンが押されたときの処理---------------------------------------
    /*function scheduleSave() {
        var scheduleArray = [];
        var i = 0;
        for (var j = new Date(start); j <= finish; j.setDate(j.getDate() + 1)) {
            for (var k = 0; k < 144; k++) {
                if ($("#cell" + i).hasClass("highlighted")) {
                    scheduleArray.push(1);
                } else {
                    scheduleArray.push(0);
                }
                i++;
            }
        }
        if (userId != null) {
            //ログインした人のための処理----------
            setLoginMember(memberName.length + 1, scheduleArray);
        } else {
            //ログインしてない人のための処理-------
            setJoinMember(getUserName(userId), scheduleArray);
        }
    }
*/
</script>


</html>